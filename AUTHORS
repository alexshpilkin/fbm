Originally written by Benjamin Walter and Kay Joerg Wiese.
Rewritten with minor modifications by Alexander Shpilkin.
